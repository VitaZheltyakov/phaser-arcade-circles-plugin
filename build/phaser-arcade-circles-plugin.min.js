/************ Phaser Arcade Circles plugin by Vitaliy Zheltyakov **************/
(function(v,g){g.Physics.Arcade.prototype.collideSpriteVsGroup=function(a,b,e,c,k,f){if(0!==b.length&&a.body)if(this.skipQuadTree||a.body.skipQuadTree)for(var d=0;d<b.hash.length;d++){if(b.hash[d]&&b.hash[d].exists&&b.hash[d].body){var m,l,n,p;m=b.hash[d].body.isCircle?b.hash[d].body.center.x-b.hash[d].body.radius:b.hash[d].body.x;l=b.hash[d].body.isCircle?b.hash[d].body.center.y-b.hash[d].body.radius:b.hash[d].body.y;n=b.hash[d].body.isCircle?b.hash[d].body.center.x+b.hash[d].body.radius:b.hash[d].body.right;
p=b.hash[d].body.isCircle?b.hash[d].body.center.y+b.hash[d].body.radius:b.hash[d].body.bottom;if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT)if(a.body.right<m)break;else{if(n<a.body.x)continue}else if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT)if(a.body.x>n)break;else{if(m>a.body.right)continue}else if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM)if(a.body.bottom<l)break;else{if(p<a.body.y)continue}else if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP)if(a.body.y>p)break;else if(l>
a.body.bottom)continue;this.collideSpriteVsSprite(a,b.hash[d],e,c,k,f)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(b),b=this.quadTree.retrieve(a),d=0;d<b.length;d++)this.separate(a.body,b[d],c,k,f)&&(e&&e.call(k,a,b[d].sprite),this._total++)};g.Physics.Arcade.prototype.collideGroupVsSelf=function(a,b,e,c,k){if(0!==a.length)for(var f=
0;f<a.hash.length;f++)if(a.hash[f]&&a.hash[f].exists&&a.hash[f].body){var d,m,l,n,p;d=a.hash[f].body.isCircle?a.hash[f].body.center.x-a.hash[f].body.radius:a.hash[f].body.x;m=a.hash[f].body.isCircle?a.hash[f].body.center.y-a.hash[f].body.radius:a.hash[f].body.y;l=a.hash[f].body.isCircle?a.hash[f].body.center.x+a.hash[f].body.radius:a.hash[f].body.right;n=a.hash[f].body.isCircle?a.hash[f].body.center.y+a.hash[f].body.radius:a.hash[f].body.bottom;p=a.hash[f];for(var h=f+1;h<a.hash.length;h++)if(a.hash[h]&&
a.hash[h].exists&&a.hash[h].body){var q,r,t,u;q=a.hash[h].body.isCircle?a.hash[h].body.center.x-a.hash[h].body.radius:a.hash[h].body.x;r=a.hash[h].body.isCircle?a.hash[h].body.center.y-a.hash[h].body.radius:a.hash[h].body.y;t=a.hash[h].body.isCircle?a.hash[h].body.center.x+a.hash[h].body.radius:a.hash[h].body.right;u=a.hash[h].body.isCircle?a.hash[h].body.center.y+a.hash[h].body.radius:a.hash[h].body.bottom;if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT)if(l<q)break;else{if(t<d)continue}else if(this.sortDirection===
g.Physics.Arcade.RIGHT_LEFT)if(d>t)continue;else{if(q>l)break}else if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM)if(n<r)continue;else{if(u<m)break}else if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP)if(m>u)continue;else if(r>n)break;this.collideSpriteVsSprite(p,a.hash[h],b,e,c,k)}}};g.Physics.Arcade.prototype.separate=function(a,b,e,c,k){if(!a.enable||!b.enable||!this.intersects(a,b)||e&&!1===e.call(c,a.sprite,b.sprite))return!1;e=!1;if(a.isCircle!==b.isCircle){var f,d,g;c=b.isCircle?a.position.x:
b.position.x;f=b.isCircle?a.position.y:b.position.y;d=b.isCircle?a.right:b.right;g=b.isCircle?a.bottom:b.bottom;var l,n;l=a.isCircle?a.position.x+a.radius:b.position.x+b.radius;n=a.isCircle?a.position.y+a.radius:b.position.y+b.radius;n<f&&(l<c&&(e=!0),l>d&&(e=!0));n>g&&(l<c&&(e=!0),l>d&&(e=!0))}if(a.isCircle&&b.isCircle||e)return this.separateCircle(a,b,k);c=e=!1;this.forceX||Math.abs(this.gravity.y+a.gravity.y)<Math.abs(this.gravity.x+a.gravity.x)?(e=this.separateX(a,b,k),this.intersects(a,b)&&(c=
this.separateY(a,b,k))):(c=this.separateY(a,b,k),this.intersects(a,b)&&(e=this.separateX(a,b,k)));return e||c};g.Physics.Arcade.prototype.intersects=function(a,b){return a.isCircle?b.isCircle?g.Math.distance(a.center.x,a.center.y,b.center.x,b.center.y)<=a.radius+b.radius:this.circleBodyIntersects(a,b):b.isCircle?this.circleBodyIntersects(b,a):a.right<=b.position.x||a.bottom<=b.position.y||a.position.x>=b.right||a.position.y>=b.bottom?!1:!0};g.Physics.Arcade.prototype.circleBodyIntersects=function(a,
b){var e=g.Math.clamp(a.center.x,b.left,b.right),c=g.Math.clamp(a.center.y,b.top,b.bottom);return(a.center.x-e)*(a.center.x-e)+(a.center.y-c)*(a.center.y-c)<=a.radius*a.radius};g.Physics.Arcade.prototype.separateCircle=function(a,b,e){this.getOverlapX(a,b);this.getOverlapY(a,b);var c=this.angleBetweenCenters(a,b),k=0;if(a.isCircle!==b.isCircle){var f,d,m,l;f=b.isCircle?a.position.x:b.position.x;d=b.isCircle?a.position.y:b.position.y;m=b.isCircle?a.right:b.right;l=b.isCircle?a.bottom:b.bottom;var n,
p,h;n=a.isCircle?a.position.x+a.radius:b.position.x+b.radius;p=a.isCircle?a.position.y+a.radius:b.position.y+b.radius;h=a.isCircle?a.radius:b.radius;p<d&&(n<f&&(k=g.Math.distance(n,p,f,d)-h),n>m&&(k=g.Math.distance(n,p,m,d)-h));p>l&&(n<f&&(k=g.Math.distance(n,p,f,l)-h),n>m&&(k=g.Math.distance(n,p,m,l)-h));k*=-1}else k=a.radius+b.radius-g.Math.distance(a.center.x,a.center.y,b.center.x,b.center.y);if(e||0===k||a.immovable&&b.immovable||a.customSeparateX||b.customSeparateX)return 0!==k;m=a.velocity.x*
Math.cos(c)+a.velocity.y*Math.sin(c);e=a.velocity.x*Math.sin(c)-a.velocity.y*Math.cos(c);l=b.velocity.x*Math.cos(c)+b.velocity.y*Math.sin(c);f=b.velocity.x*Math.sin(c)-b.velocity.y*Math.cos(c);d=((a.mass-b.mass)*m+2*b.mass*l)/(a.mass+b.mass);m=(2*a.mass*m+(b.mass-a.mass)*l)/(a.mass+b.mass);a.immovable||(a.velocity.x=(d*Math.cos(c)-e*Math.sin(c))*a.bounce.x,a.velocity.y=(e*Math.cos(c)+d*Math.sin(c))*a.bounce.y);b.immovable||(b.velocity.x=(m*Math.cos(c)-f*Math.sin(c))*b.bounce.x,b.velocity.y=(f*Math.cos(c)+
m*Math.sin(c))*b.bounce.y);0<c&&(Math.abs(c)<Math.PI/2?0<a.velocity.x&&!a.immovable?a.velocity.x*=-1:0>b.velocity.x&&!b.immovable?b.velocity.x*=-1:0<a.velocity.y&&!a.immovable?a.velocity.y*=-1:0>b.velocity.y&&!b.immovable&&(b.velocity.y*=-1):Math.abs(c)>Math.PI/2&&(0>a.velocity.x&&!a.immovable?a.velocity.x*=-1:0<b.velocity.x&&!b.immovable?b.velocity.x*=-1:0>a.velocity.y&&!a.immovable?a.velocity.y*=-1:0<b.velocity.y&&!b.immovable&&(b.velocity.y*=-1)));0>c&&(Math.abs(c)<Math.PI/2?0<a.velocity.x&&!a.immovable?
a.velocity.x*=-1:0>b.velocity.x&&!b.immovable?b.velocity.x*=-1:0<a.velocity.y&&!a.immovable?a.velocity.y*=-1:0>b.velocity.y&&!b.immovable&&(b.velocity.y*=-1):Math.abs(c)>Math.PI/2&&(0>a.velocity.x&&!a.immovable?a.velocity.x*=-1:0<b.velocity.x&&!b.immovable?b.velocity.x*=-1:0>a.velocity.y&&!a.immovable?a.velocity.y*=-1:0<b.velocity.y&&!b.immovable&&(b.velocity.y*=-1)));a.immovable||(a.x+=a.velocity.x*this.game.time.physicsElapsed-k*Math.cos(c));b.immovable||(b.x+=b.velocity.x*this.game.time.physicsElapsed+
k*Math.cos(c));a.immovable||(a.y+=a.velocity.y*this.game.time.physicsElapsed-k*Math.sin(c));b.immovable||(b.y+=b.velocity.y*this.game.time.physicsElapsed+k*Math.sin(c));return!0};g.Physics.Arcade.prototype.distanceBetweenCenters=function(a,b){var e=a.center.x-b.center.x,c=a.center.y-b.center.y;return Math.sqrt(e*e+c*c)};g.Physics.Arcade.prototype.angleBetweenCenters=function(a,b){return Math.atan2(b.center.y-a.center.y,b.center.x-a.center.x)};g.Physics.Arcade.Body.prototype.checkWorldBounds=function(){var a=
this.position,b=this.game.physics.arcade.bounds,e=this.game.physics.arcade.checkCollision,c=this.worldBounce?-this.worldBounce.x:-this.bounce.x,g=this.worldBounce?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var f,d,m,l;f=this.center.x-this.radius;d=this.center.y-this.radius;m=this.center.x+this.radius;l=this.center.y+this.radius;f<b.x&&e.left?(a.x=b.x-this.halfWidth+this.radius,this.velocity.x*=c,this.blocked.left=!0):m>b.right&&e.right&&(a.x=b.right-this.halfWidth-this.radius,this.velocity.x*=
c,this.blocked.right=!0);d<b.y&&e.up?(a.y=b.y-this.halfHeight+this.radius,this.velocity.y*=g,this.blocked.up=!0):l>b.bottom&&e.down&&(a.y=b.bottom-this.halfHeight-this.radius,this.velocity.y*=g,this.blocked.down=!0)}else a.x<b.x&&e.left?(a.x=b.x,this.velocity.x*=c,this.blocked.left=!0):this.right>b.right&&e.right&&(a.x=b.right-this.width,this.velocity.x*=c,this.blocked.right=!0),a.y<b.y&&e.up?(a.y=b.y,this.velocity.y*=g,this.blocked.up=!0):this.bottom>b.bottom&&e.down&&(a.y=b.bottom-this.height,this.velocity.y*=
g,this.blocked.down=!0)};g.Physics.Arcade.Body.render=function(a,b,e,c){void 0===c&&(c=!0);e=e||"rgba(0,255,0,0.4)";c?(a.fillStyle=e,b.isCircle?(a.beginPath(),a.arc(b.center.x-b.game.camera.x,b.center.y-b.game.camera.y,b.radius,0,2*Math.PI,!1),a.fill()):a.fillRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height)):(a.strokeStyle=e,b.isCircle?(a.beginPath(),a.arc(b.position.x-b.game.camera.x+b.radius,b.position.y-b.game.camera.y+b.radius,b.radius,0,2*Math.PI,!1),a.stroke()):
a.strokeRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height))}})(window,Phaser);