/************ Phaser Arcade Circles plugin by Vitaliy Zheltyakov **************/
(function(v,g){g.Physics.Arcade.prototype.collideSpriteVsGroup=function(a,b,d,c,n,f){if(0!==b.length&&a.body)if(this.skipQuadTree||a.body.skipQuadTree)for(var e=0;e<b.hash.length;e++){if(b.hash[e]&&b.hash[e].exists&&b.hash[e].body){var k,l,m,p;k=b.hash[e].body.isCircle?b.hash[e].body.center.x-b.hash[e].body.radius:b.hash[e].body.x;l=b.hash[e].body.isCircle?b.hash[e].body.center.y-b.hash[e].body.radius:b.hash[e].body.y;m=b.hash[e].body.isCircle?b.hash[e].body.center.x+b.hash[e].body.radius:b.hash[e].body.right;
p=b.hash[e].body.isCircle?b.hash[e].body.center.y+b.hash[e].body.radius:b.hash[e].body.bottom;if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT)if(a.body.right<k)break;else{if(m<a.body.x)continue}else if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT)if(a.body.x>m)break;else{if(k>a.body.right)continue}else if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM)if(a.body.bottom<l)break;else{if(p<a.body.y)continue}else if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP)if(a.body.y>p)break;else if(l>
a.body.bottom)continue;this.collideSpriteVsSprite(a,b.hash[e],d,c,n,f)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(b),b=this.quadTree.retrieve(a),e=0;e<b.length;e++)this.separate(a.body,b[e],c,n,f)&&(d&&d.call(n,a,b[e].sprite),this._total++)};g.Physics.Arcade.prototype.collideGroupVsSelf=function(a,b,d,c,n){if(0!==a.length)for(var f=
0;f<a.hash.length;f++)if(a.hash[f]&&a.hash[f].exists&&a.hash[f].body){var e,k,l,m,p;e=a.hash[f].body.isCircle?a.hash[f].body.center.x-a.hash[f].body.radius:a.hash[f].body.x;k=a.hash[f].body.isCircle?a.hash[f].body.center.y-a.hash[f].body.radius:a.hash[f].body.y;l=a.hash[f].body.isCircle?a.hash[f].body.center.x+a.hash[f].body.radius:a.hash[f].body.right;m=a.hash[f].body.isCircle?a.hash[f].body.center.y+a.hash[f].body.radius:a.hash[f].body.bottom;p=a.hash[f];for(var h=f+1;h<a.hash.length;h++)if(a.hash[h]&&
a.hash[h].exists&&a.hash[h].body){var q,r,t,u;q=a.hash[h].body.isCircle?a.hash[h].body.center.x-a.hash[h].body.radius:a.hash[h].body.x;r=a.hash[h].body.isCircle?a.hash[h].body.center.y-a.hash[h].body.radius:a.hash[h].body.y;t=a.hash[h].body.isCircle?a.hash[h].body.center.x+a.hash[h].body.radius:a.hash[h].body.right;u=a.hash[h].body.isCircle?a.hash[h].body.center.y+a.hash[h].body.radius:a.hash[h].body.bottom;if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT)if(l<q)break;else{if(t<e)continue}else if(this.sortDirection===
g.Physics.Arcade.RIGHT_LEFT)if(e>t)continue;else{if(q>l)break}else if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM)if(m<r)continue;else{if(u<k)break}else if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP)if(k>u)continue;else if(r>m)break;this.collideSpriteVsSprite(p,a.hash[h],b,d,c,n)}}};g.Physics.Arcade.prototype.separate=function(a,b,d,c,g){if(!a.enable||!b.enable||!this.intersects(a,b)||d&&!1===d.call(c,a.sprite,b.sprite))return!1;d=!1;if(a.isCircle!==b.isCircle){var f,e,k;c=b.isCircle?a.position.x:
b.position.x;f=b.isCircle?a.position.y:b.position.y;e=b.isCircle?a.right:b.right;k=b.isCircle?a.bottom:b.bottom;var l,m;l=a.isCircle?a.position.x+a.radius:b.position.x+b.radius;m=a.isCircle?a.position.y+a.radius:b.position.y+b.radius;m<f&&(l<c&&(d=!0),l>e&&(d=!0));m>k&&(l<c&&(d=!0),l>e&&(d=!0))}if(a.isCircle&&b.isCircle||d)return this.separateCircle(a,b,g);c=d=!1;this.forceX||Math.abs(this.gravity.y+a.gravity.y)<Math.abs(this.gravity.x+a.gravity.x)?(d=this.separateX(a,b,g),this.intersects(a,b)&&(c=
this.separateY(a,b,g))):(c=this.separateY(a,b,g),this.intersects(a,b)&&(d=this.separateX(a,b,g)));return d||c};g.Physics.Arcade.prototype.intersects=function(a,b){return a===b?!1:a.isCircle?b.isCircle?g.Math.distance(a.center.x,a.center.y,b.center.x,b.center.y)<=a.radius+b.radius:this.circleBodyIntersects(a,b):b.isCircle?this.circleBodyIntersects(b,a):a.right<=b.position.x||a.bottom<=b.position.y||a.position.x>=b.right||a.position.y>=b.bottom?!1:!0};g.Physics.Arcade.prototype.circleBodyIntersects=
function(a,b){var d=g.Math.clamp(a.center.x,b.left,b.right),c=g.Math.clamp(a.center.y,b.top,b.bottom);return(a.center.x-d)*(a.center.x-d)+(a.center.y-c)*(a.center.y-c)<=a.radius*a.radius};g.Physics.Arcade.prototype.separateCircle=function(a,b,d){this.getOverlapX(a,b);this.getOverlapY(a,b);var c=this.angleBetweenCenters(a,b),n=0;if(a.isCircle!==b.isCircle){var f,e,k,l;f=b.isCircle?a.position.x:b.position.x;e=b.isCircle?a.position.y:b.position.y;k=b.isCircle?a.right:b.right;l=b.isCircle?a.bottom:b.bottom;
var m,p,h;m=a.isCircle?a.position.x+a.radius:b.position.x+b.radius;p=a.isCircle?a.position.y+a.radius:b.position.y+b.radius;h=a.isCircle?a.radius:b.radius;p<e&&(m<f&&(n=g.Math.distance(m,p,f,e)-h),m>k&&(n=g.Math.distance(m,p,k,e)-h));p>l&&(m<f&&(n=g.Math.distance(m,p,f,l)-h),m>k&&(n=g.Math.distance(m,p,k,l)-h));n*=-1}else n=a.radius+b.radius-g.Math.distance(a.center.x,a.center.y,b.center.x,b.center.y);if(d||0===n||a.immovable&&b.immovable||a.customSeparateX||b.customSeparateX)return 0!==n;k=a.velocity.x*
Math.cos(c)+a.velocity.y*Math.sin(c);d=a.velocity.x*Math.sin(c)-a.velocity.y*Math.cos(c);l=b.velocity.x*Math.cos(c)+b.velocity.y*Math.sin(c);f=b.velocity.x*Math.sin(c)-b.velocity.y*Math.cos(c);e=((a.mass-b.mass)*k+2*b.mass*l)/(a.mass+b.mass);k=(2*a.mass*k+(b.mass-a.mass)*l)/(a.mass+b.mass);a.immovable||(a.velocity.x=(e*Math.cos(c)-d*Math.sin(c))*a.bounce.x,a.velocity.y=(d*Math.cos(c)+e*Math.sin(c))*a.bounce.y);b.immovable||(b.velocity.x=(k*Math.cos(c)-f*Math.sin(c))*b.bounce.x,b.velocity.y=(f*Math.cos(c)+
k*Math.sin(c))*b.bounce.y);Math.abs(c)<Math.PI/2?0<a.velocity.x&&!a.immovable&&b.velocity.x>a.velocity.x?a.velocity.x*=-1:0>b.velocity.x&&!b.immovable&&a.velocity.x<b.velocity.x?b.velocity.x*=-1:0<a.velocity.y&&!a.immovable&&b.velocity.y>a.velocity.y?a.velocity.y*=-1:0>b.velocity.y&&!b.immovable&&a.velocity.y<b.velocity.y&&(b.velocity.y*=-1):Math.abs(c)>Math.PI/2&&(0>a.velocity.x&&!a.immovable&&b.velocity.x<a.velocity.x?a.velocity.x*=-1:0<b.velocity.x&&!b.immovable&&a.velocity.x>b.velocity.x?b.velocity.x*=
-1:0>a.velocity.y&&!a.immovable&&b.velocity.y<a.velocity.y?a.velocity.y*=-1:0<b.velocity.y&&!b.immovable&&a.velocity.x>b.velocity.y&&(b.velocity.y*=-1));a.immovable||(a.x+=a.velocity.x*this.game.time.physicsElapsed-n*Math.cos(c));b.immovable||(b.x+=b.velocity.x*this.game.time.physicsElapsed+n*Math.cos(c));a.immovable||(a.y+=a.velocity.y*this.game.time.physicsElapsed-n*Math.sin(c));b.immovable||(b.y+=b.velocity.y*this.game.time.physicsElapsed+n*Math.sin(c));return!0};g.Physics.Arcade.prototype.distanceBetweenCenters=
function(a,b){var d=a.center.x-b.center.x,c=a.center.y-b.center.y;return Math.sqrt(d*d+c*c)};g.Physics.Arcade.prototype.angleBetweenCenters=function(a,b){return Math.atan2(b.center.y-a.center.y,b.center.x-a.center.x)};g.Physics.Arcade.Body.prototype.isCircle=!1;g.Physics.Arcade.Body.prototype.radius=0;g.Physics.Arcade.Body.prototype.setCircle=function(a,b,d){void 0===b&&(b=this.offset.x);void 0===d&&(d=this.offset.y);0<a?(this.isCircle=!0,this.radius=a,this.sourceWidth=2*a,this.sourceHeight=2*a,this.width=
this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(b,d),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)):this.isCircle=!1};g.Physics.Arcade.Body.prototype.checkWorldBounds=function(){var a=this.position,b=this.game.physics.arcade.bounds,d=this.game.physics.arcade.checkCollision,c=this.worldBounce?-this.worldBounce.x:-this.bounce.x,g=this.worldBounce?-this.worldBounce.y:
-this.bounce.y;if(this.isCircle){var f,e,k,l;f=this.center.x-this.radius;e=this.center.y-this.radius;k=this.center.x+this.radius;l=this.center.y+this.radius;f<b.x&&d.left?(a.x=b.x-this.halfWidth+this.radius,this.velocity.x*=c,this.blocked.left=!0):k>b.right&&d.right&&(a.x=b.right-this.halfWidth-this.radius,this.velocity.x*=c,this.blocked.right=!0);e<b.y&&d.up?(a.y=b.y-this.halfHeight+this.radius,this.velocity.y*=g,this.blocked.up=!0):l>b.bottom&&d.down&&(a.y=b.bottom-this.halfHeight-this.radius,this.velocity.y*=
g,this.blocked.down=!0)}else a.x<b.x&&d.left?(a.x=b.x,this.velocity.x*=c,this.blocked.left=!0):this.right>b.right&&d.right&&(a.x=b.right-this.width,this.velocity.x*=c,this.blocked.right=!0),a.y<b.y&&d.up?(a.y=b.y,this.velocity.y*=g,this.blocked.up=!0):this.bottom>b.bottom&&d.down&&(a.y=b.bottom-this.height,this.velocity.y*=g,this.blocked.down=!0)};g.Physics.Arcade.Body.render=function(a,b,d,c){void 0===c&&(c=!0);d=d||"rgba(0,255,0,0.4)";c?(a.fillStyle=d,b.isCircle?(a.beginPath(),a.arc(b.center.x-
b.game.camera.x,b.center.y-b.game.camera.y,b.radius,0,2*Math.PI,!1),a.fill()):a.fillRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height)):(a.strokeStyle=d,b.isCircle?(a.beginPath(),a.arc(b.position.x-b.game.camera.x+b.radius,b.position.y-b.game.camera.y+b.radius,b.radius,0,2*Math.PI,!1),a.stroke()):a.strokeRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height))}})(window,Phaser);