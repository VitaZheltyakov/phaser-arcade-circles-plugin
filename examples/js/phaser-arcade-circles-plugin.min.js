/************ Phaser Arcade Circles plugin by Vitaliy Zheltyakov **************/
(function(v,m){m.Physics.Arcade.prototype.collideSpriteVsGroup=function(a,b,c,d,g,e){if(0!==b.length&&a.body)if(this.skipQuadTree||a.body.skipQuadTree)for(var f=0;f<b.hash.length;f++){if(b.hash[f]&&b.hash[f].exists&&b.hash[f].body){var l,h,p,k;l=b.hash[f].body.isCircle?b.hash[f].body.center.x-b.hash[f].body.radius:b.hash[f].body.x;h=b.hash[f].body.isCircle?b.hash[f].body.center.y-b.hash[f].body.radius:b.hash[f].body.y;p=b.hash[f].body.isCircle?b.hash[f].body.center.x+b.hash[f].body.radius:b.hash[f].body.right;
k=b.hash[f].body.isCircle?b.hash[f].body.center.y+b.hash[f].body.radius:b.hash[f].body.bottom;if(this.sortDirection===m.Physics.Arcade.LEFT_RIGHT)if(a.body.right<l)break;else{if(p<a.body.x)continue}else if(this.sortDirection===m.Physics.Arcade.RIGHT_LEFT)if(a.body.x>p)break;else{if(l>a.body.right)continue}else if(this.sortDirection===m.Physics.Arcade.TOP_BOTTOM)if(a.body.bottom<h)break;else{if(k<a.body.y)continue}else if(this.sortDirection===m.Physics.Arcade.BOTTOM_TOP)if(a.body.y>k)break;else if(h>
a.body.bottom)continue;this.collideSpriteVsSprite(a,b.hash[f],c,d,g,e)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(b),b=this.quadTree.retrieve(a),f=0;f<b.length;f++)this.separate(a.body,b[f],d,g,e)&&(c&&c.call(g,a,b[f].sprite),this._total++)};m.Physics.Arcade.prototype.collideGroupVsSelf=function(a,b,c,d,g){if(0!==a.length)for(var e=
0;e<a.hash.length;e++)if(a.hash[e]&&a.hash[e].exists&&a.hash[e].body){var f,l,h,p,k;f=a.hash[e].body.isCircle?a.hash[e].body.center.x-a.hash[e].body.radius:a.hash[e].body.x;l=a.hash[e].body.isCircle?a.hash[e].body.center.y-a.hash[e].body.radius:a.hash[e].body.y;h=a.hash[e].body.isCircle?a.hash[e].body.center.x+a.hash[e].body.radius:a.hash[e].body.right;p=a.hash[e].body.isCircle?a.hash[e].body.center.y+a.hash[e].body.radius:a.hash[e].body.bottom;k=a.hash[e];for(var n=e+1;n<a.hash.length;n++)if(a.hash[n]&&
a.hash[n].exists&&a.hash[n].body){var q,r,t,u;q=a.hash[n].body.isCircle?a.hash[n].body.center.x-a.hash[n].body.radius:a.hash[n].body.x;r=a.hash[n].body.isCircle?a.hash[n].body.center.y-a.hash[n].body.radius:a.hash[n].body.y;t=a.hash[n].body.isCircle?a.hash[n].body.center.x+a.hash[n].body.radius:a.hash[n].body.right;u=a.hash[n].body.isCircle?a.hash[n].body.center.y+a.hash[n].body.radius:a.hash[n].body.bottom;if(this.sortDirection===m.Physics.Arcade.LEFT_RIGHT)if(h<q)break;else{if(t<f)continue}else if(this.sortDirection===
m.Physics.Arcade.RIGHT_LEFT)if(f>t)continue;else{if(q>h)break}else if(this.sortDirection===m.Physics.Arcade.TOP_BOTTOM)if(p<r)continue;else{if(u<l)break}else if(this.sortDirection===m.Physics.Arcade.BOTTOM_TOP)if(l>u)continue;else if(r>p)break;this.collideSpriteVsSprite(k,a.hash[n],b,c,d,g)}}};m.Physics.Arcade.prototype.intersects=function(a,b){if(a.isCircle&&b.isCircle)return this.distanceBetweenCenters(a,b)<=a.radius+b.radius;if(!a.isCircle&&!b.isCircle){if(a.right<=b.position.x||a.bottom<=b.position.y||
a.position.x>=b.right||a.position.y>=b.bottom)return!1}else if(a.isCircle!==b.isCircle){var c,d,g,e;c=b.isCircle?a.position.x:b.position.x;d=b.isCircle?a.position.y:b.position.y;g=b.isCircle?a.right:b.right;e=b.isCircle?a.bottom:b.bottom;var f,l,h;f=a.isCircle?a.position.x+a.radius:b.position.x+b.radius;l=a.isCircle?a.position.y+a.radius:b.position.y+b.radius;h=a.isCircle?a.radius:b.radius;return l<d?f<c?(f-c)*(f-c)+(l-d)*(l-d)<=h*h:f>g?(f-g)*(f-g)+(l-d)*(l-d)<=h*h:d-l<=h:l>e?f<c?(f-c)*(f-c)+(l-e)*
(l-e)<=h*h:f>g?(f-g)*(f-g)+(l-e)*(l-e)<=h*h:l-e<=h:f<c?c-f<=h:f>g?f-g<=h:f-c<=h||g-f<=h||l-d<=h||e-l<=h}return!0};m.Physics.Arcade.prototype.getOverlapX=function(a,b){var c=0,d=a.deltaAbsX()+b.deltaAbsX()+this.OVERLAP_BIAS;a.isCircle&&(d+=a.radius);b.isCircle&&(d+=b.radius);0===a.deltaX()&&0===b.deltaX()?(a.embedded=!0,b.embedded=!0):a.deltaX()>b.deltaX()?(c=a.right-b.x,c>d||!1===a.checkCollision.right||!1===b.checkCollision.left?c=0:(a.touching.none=!1,a.touching.right=!0,b.touching.none=!1,b.touching.left=
!0)):a.deltaX()<b.deltaX()&&(c=a.x-b.width-b.x,-c>d||!1===a.checkCollision.left||!1===b.checkCollision.right?c=0:(a.touching.none=!1,a.touching.left=!0,b.touching.none=!1,b.touching.right=!0));a.overlapX=c;return b.overlapX=c};m.Physics.Arcade.prototype.getOverlapY=function(a,b){var c=0,d=a.deltaAbsY()+b.deltaAbsY()+this.OVERLAP_BIAS;a.isCircle&&(d+=a.radius);b.isCircle&&(d+=b.radius);0===a.deltaY()&&0===b.deltaY()?(a.embedded=!0,b.embedded=!0):a.deltaY()>b.deltaY()?(c=a.bottom-b.y,c>d||!1===a.checkCollision.down||
!1===b.checkCollision.up?c=0:(a.touching.none=!1,a.touching.down=!0,b.touching.none=!1,b.touching.up=!0)):a.deltaY()<b.deltaY()&&(c=a.y-b.bottom,-c>d||!1===a.checkCollision.up||!1===b.checkCollision.down?c=0:(a.touching.none=!1,a.touching.up=!0,b.touching.none=!1,b.touching.down=!0));a.overlapY=c;return b.overlapY=c};m.Physics.Arcade.prototype.separateX=function(a,b,c){var d=this.getOverlapX(a,b);if(c||0===d||a.immovable&&b.immovable||a.customSeparateX||b.customSeparateX)return 0!==d;if(a.isCircle!==
b.isCircle){var g=!1,e,f,l;c=b.isCircle?a.position.x:b.position.x;e=b.isCircle?a.position.y:b.position.y;f=b.isCircle?a.right:b.right;l=b.isCircle?a.bottom:b.bottom;var h,m;h=a.isCircle?a.position.x+a.radius:b.position.x+b.radius;m=a.isCircle?a.position.y+a.radius:b.position.y+b.radius;m<e&&(h<c&&(g=!0),h>f&&(g=!0));m>l&&(h<c&&(g=!0),h>f&&(g=!0))}if(a.isCircle&&b.isCircle||g)var k=this.angleBetweenCenters(a,b);c=a.velocity.x;e=b.velocity.x;a.immovable||b.immovable?a.immovable?b.immovable||(a.isCircle&&
b.isCircle||g?(b.x+=0<d?a.deltaAbsX()+b.deltaAbsX():-(a.deltaAbsX()+b.deltaAbsX()),b.velocity.x=(c-e*b.bounce.x)*Math.cos(k)*Math.cos(k),b.velocity.y+=(c-e*b.bounce.y)*Math.cos(k)*Math.sin(k)):(a.isCircle||b.isCircle)&&g||(b.x+=d,b.velocity.x=c-e*b.bounce.x,a.moves&&(b.y+=(a.y-a.prev.y)*a.friction.y))):a.isCircle&&b.isCircle||g?(a.x+=0<d?-(a.deltaAbsX()+b.deltaAbsX()):a.deltaAbsX()+b.deltaAbsX(),a.velocity.x=(e-c*a.bounce.x)*Math.cos(k)*Math.cos(k),a.velocity.y+=(e-c*a.bounce.y)*Math.cos(k)*Math.sin(k)):
(a.isCircle||b.isCircle)&&g||(a.x-=d,a.velocity.x=e-c*a.bounce.x,b.moves&&(a.y+=(b.y-b.prev.y)*b.friction.y)):a.isCircle&&b.isCircle||g?(a.x+=0<d?a.deltaAbsX()+b.deltaAbsX():-(a.deltaAbsX()+b.deltaAbsX()),b.x+=0<d?a.deltaAbsX()+b.deltaAbsX():-(a.deltaAbsX()+b.deltaAbsX()),d=Math.sqrt(e*e*b.mass/a.mass)*(0<e?1:-1),g=Math.sqrt(c*c*a.mass/b.mass)*(0<c?1:-1),c=.5*(d+g),d-=c,g-=c,a.velocity.x=(c+d*a.bounce.x)*Math.cos(k)*Math.cos(k),a.velocity.y+=-(c+d*a.bounce.y)*Math.cos(k)*Math.sin(k),b.velocity.x=
(c+g*b.bounce.x)*Math.cos(k)*Math.cos(k),b.velocity.y+=(c+g*b.bounce.y)*Math.cos(k)*Math.sin(k)):(a.isCircle||b.isCircle)&&g||(d*=.5,a.x-=d,b.x+=d,d=Math.sqrt(e*e*b.mass/a.mass)*(0<e?1:-1),g=Math.sqrt(c*c*a.mass/b.mass)*(0<c?1:-1),c=.5*(d+g),a.velocity.x=c+(d-c)*a.bounce.x,b.velocity.x=c+(g-c)*b.bounce.x);return!0};m.Physics.Arcade.prototype.separateY=function(a,b,c){var d=this.getOverlapY(a,b);if(c||0===d||a.immovable&&b.immovable||a.customSeparateY||b.customSeparateY)return 0!==d;if(a.isCircle!==
b.isCircle){var g=!1,e,f,l;c=b.isCircle?a.position.x:b.position.x;e=b.isCircle?a.position.y:b.position.y;f=b.isCircle?a.right:b.right;l=b.isCircle?a.bottom:b.bottom;var h,m;h=a.isCircle?a.position.x+a.radius:b.position.x+b.radius;m=a.isCircle?a.position.y+a.radius:b.position.y+b.radius;m<e&&(h<c&&(g=!0),h>f&&(g=!0));m>l&&(h<c&&(g=!0),h>f&&(g=!0))}if(a.isCircle&&b.isCircle||g)var k=this.angleBetweenCenters(a,b);c=a.velocity.y;e=b.velocity.y;a.immovable||b.immovable?a.immovable?a.isCircle&&b.isCircle||
g?(b.y+=0<d?a.deltaAbsY()+b.deltaAbsY():-(a.deltaAbsY()+b.deltaAbsY()),b.velocity.x+=(c-e*b.bounce.x)*Math.cos(k)*Math.cos(k),b.velocity.y=(c-e*b.bounce.y)*Math.cos(k)*Math.sin(k)):(a.isCircle||b.isCircle)&&g||(b.y+=d,b.velocity.y=c-e*b.bounce.y,a.moves&&(b.x+=(a.x-a.prev.x)*a.friction.x)):a.isCircle&&b.isCircle||g?(a.y+=0<d?-(a.deltaAbsY()+b.deltaAbsY()):a.deltaAbsY()+b.deltaAbsY(),a.velocity.x+=(e-c*a.bounce.x)*Math.cos(k)*Math.cos(k),a.velocity.y=(e-c*a.bounce.y)*Math.cos(k)*Math.sin(k)):(a.isCircle||
b.isCircle)&&g||(a.y-=d,a.velocity.y=e-c*a.bounce.y,b.moves&&(a.x+=(b.x-b.prev.x)*b.friction.x)):a.isCircle&&b.isCircle||g?(a.y+=0<d?a.deltaAbsY()+b.deltaAbsY():-(a.deltaAbsY()+b.deltaAbsY()),b.y+=0<d?a.deltaAbsY()+b.deltaAbsY():-(a.deltaAbsY()+b.deltaAbsY()),d=Math.sqrt(e*e*b.mass/a.mass)*(0<e?1:-1),g=Math.sqrt(c*c*a.mass/b.mass)*(0<c?1:-1),c=.5*(d+g),d-=c,g-=c,a.velocity.x+=-(c+d*a.bounce.x)*Math.sin(k)*Math.cos(k),a.velocity.y=(c+d*a.bounce.y)*Math.sin(k)*Math.sin(k),b.velocity.x+=(c+g*b.bounce.x)*
Math.sin(k)*Math.cos(k),b.velocity.y=(c+g*b.bounce.y)*Math.sin(k)*Math.sin(k)):(a.isCircle||b.isCircle)&&g||(d*=.5,a.y-=d,b.y+=d,d=Math.sqrt(e*e*b.mass/a.mass)*(0<e?1:-1),g=Math.sqrt(c*c*a.mass/b.mass)*(0<c?1:-1),c=.5*(d+g),a.velocity.y=c+(d-c)*a.bounce.y,b.velocity.y=c+(g-c)*b.bounce.y);return!0};m.Physics.Arcade.prototype.distanceBetweenCenters=function(a,b){var c=a.center.x-b.center.x,d=a.center.y-b.center.y;return Math.sqrt(c*c+d*d)};m.Physics.Arcade.prototype.angleBetweenCenters=function(a,b){return Math.atan2(b.center.y-
a.center.y,b.center.x-a.center.x)};m.Physics.Arcade.Body.prototype.checkWorldBounds=function(){var a=this.position,b=this.game.physics.arcade.bounds,c=this.game.physics.arcade.checkCollision,d=this.worldBounce?-this.worldBounce.x:-this.bounce.x,g=this.worldBounce?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var e,f,l,h;e=this.center.x-this.radius;f=this.center.y-this.radius;l=this.center.x+this.radius;h=this.center.y+this.radius;e<b.x&&c.left?(a.x=b.x-this.halfWidth+this.radius,this.velocity.x*=
d,this.blocked.left=!0):l>b.right&&c.right&&(a.x=b.right-this.halfWidth-this.radius,this.velocity.x*=d,this.blocked.right=!0);f<b.y&&c.up?(a.y=b.y-this.halfHeight+this.radius,this.velocity.y*=g,this.blocked.up=!0):h>b.bottom&&c.down&&(a.y=b.bottom-this.halfHeight-this.radius,this.velocity.y*=g,this.blocked.down=!0)}else a.x<b.x&&c.left?(a.x=b.x,this.velocity.x*=d,this.blocked.left=!0):this.right>b.right&&c.right&&(a.x=b.right-this.width,this.velocity.x*=d,this.blocked.right=!0),a.y<b.y&&c.up?(a.y=
b.y,this.velocity.y*=g,this.blocked.up=!0):this.bottom>b.bottom&&c.down&&(a.y=b.bottom-this.height,this.velocity.y*=g,this.blocked.down=!0)};m.Physics.Arcade.Body.render=function(a,b,c,d){void 0===d&&(d=!0);c=c||"rgba(0,255,0,0.4)";d?(a.fillStyle=c,b.isCircle?(a.beginPath(),a.arc(b.center.x-b.game.camera.x,b.center.y-b.game.camera.y,b.radius,0,2*Math.PI,!1),a.fill()):a.fillRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height)):(a.strokeStyle=c,b.isCircle?(a.beginPath(),
a.arc(b.position.x-b.game.camera.x+b.radius,b.position.y-b.game.camera.y+b.radius,b.radius,0,2*Math.PI,!1),a.stroke()):a.strokeRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height))}})(window,Phaser);